<!doctype html>
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <meta name="viewport" content="width=device-width" />

  <title>Chat Form</title>

  <script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js"></script>
  <script type="text/javascript">
  	$(function () {
  		setInterval(function () {
  			$.get('/chat/messages/', function (data) {
  				var messages = $('#messages');
  				var n = "";
  				$.each(data, function(i, msg) {
  					n += msg.username + ": " +
  						 msg.message + "\n";
  				});
  				messages.text(n);
  				messages.scrollTop(
  					messages[0].scrollHeight - messages.height()
  				);
  				
  			});
  		}, 1000);
  		
  		$('#chatform').submit(function (e) {
  			e.preventDefault();
  			if ($('#message').val() == '') 
  			    return; 
  			$.post('/chat/messages/', {
  				'username': $('#username').val(),
  				'message': $('#message').val()
  			});
  			$('#message').val('');
  		});
  	});
  
  </script>
  <style type="text/css">
    html, body { margin: 0.5%; }
  	textarea { width: 99%; height:150px; }
  	input { width:99%; }
  </style>
</head>

<body>
	<textarea id="messages" readonly></textarea>
	<form id="chatform" method="post" action="/chat/messages/">
		<input id="username" type="hidden" name="username" value="@username" />
		<input id="message" name="message" /><br />
		<input type="submit" value="Send"/>
	</form>
</body>
</html>