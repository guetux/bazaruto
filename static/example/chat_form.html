<!doctype html>
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">

  <title>Chat Form</title>

  <script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js"></script>
  <script type="text/javascript">
  	$(function () {
  		setInterval(function () {
  			$.get('/chat/messages/', function (data) {
  				var n = "";
  				$.each(data, function(i, msg) {
  					n += "<tr><th>"+msg.username+"</th><td>"+msg.message+"</td></tr>";
  				});
  				$("#messages").html(n);
  				
  			});
  		}, 5000);
  		
  		$('#chatform').submit(function (e) {
  			e.preventDefault();
  			$.post('/chat/messages/', {
  				'username': $('input[name=username').val(),
  				'message': $('input[name=message').val()
  			});
  			
  		});
  	});
  
  </script>
</head>

<body>
	<table id="messages" ></table>
	<form id="chatform" method="post" action="/chat/messages/">
		<input type="hidden" name="username" value="@username" />
		<input name="message" />
		<input type="submit"/>
	</form>
</body>
</html>